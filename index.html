<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歯科医院 日計表入力</title>
    <style>
        @media print { 
            @page { 
                size: B5 landscape; 
                margin: 0.3cm; 
            }
            .no-print { display: none !important; } 
            .print-block { display: block !important; } 
            body { 
                margin: 0 !important; 
                padding: 0 !important;
                background: white !important; 
                font-size: 10px !important;
                width: 100% !important;
                height: 100% !important;
                overflow: visible !important;
                font-family: 'MS Gothic', monospace !important;
            }
            input { 
                border: none !important; 
                background: none !important; 
                color: black !important; 
                -webkit-appearance: none !important;
                appearance: none !important;
                font-size: 9px !important;
                font-family: 'MS Gothic', monospace !important;
                font-weight: bold !important;
            } 
            .print-container { 
                max-width: 100% !important; 
                width: 100% !important;
                margin: 0 !important; 
                padding: 0 !important;
                font-size: 10px !important; 
                border: 2px solid black !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
                height: 100vh !important;
                display: flex !important;
                flex-direction: column !important;
            }
            table { 
                font-size: 9px !important; 
                page-break-inside: avoid !important;
                width: 100% !important;
                table-layout: fixed !important;
                border-collapse: collapse !important;
                margin-bottom: 8px !important;
            }
            th, td { 
                padding: 2px 1px !important; 
                font-size: 9px !important;
                line-height: 1.1 !important;
                word-wrap: break-word !important;
                overflow: hidden !important;
                border: 1px solid black !important;
                text-align: center !important;
                font-family: 'MS Gothic', monospace !important;
            }
            .grid { 
                display: grid !important; 
                grid-template-columns: 40% 60% !important; 
                gap: 8px !important;
                width: 100% !important;
                height: auto !important;
                flex: 1 !important;
            }
            .print-header {
                font-size: 12px !important;
                padding: 3px !important;
                line-height: 1.2 !important;
                text-align: center !important;
                font-weight: bold !important;
                border-bottom: 2px solid black !important;
                margin-bottom: 3px !important;
            }
            .print-date {
                font-size: 9px !important;
                padding: 2px !important;
                line-height: 1.1 !important;
                text-align: center !important;
                border-bottom: 1px solid black !important;
                margin-bottom: 5px !important;
            }
            .print-input-s { width: 25px !important; font-size: 8px !important; text-align: right !important; }
            .print-input-m { width: 35px !important; font-size: 8px !important; text-align: right !important; }
            .print-input-l { width: 50px !important; font-size: 8px !important; text-align: right !important; }
            .print-input-center { text-align: center !important; }
            
            .left-section, .right-section {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
            
            .spacer {
                display: none !important;
            }
            
            .total-row {
                background-color: #e8e8e8 !important;
                font-weight: bold !important;
            }
            
            .data-row {
                background-color: #f8f8f8 !important;
            }
            
            th {
                background-color: #d0d0d0 !important;
                font-weight: bold !important;
            }
            
            .compact-table {
                margin-bottom: 4px !important;
            }
            
            /* 印刷時のセル幅調整 */
            .col-item { width: 30% !important; }
            .col-count { width: 25% !important; }
            .col-amount { width: 45% !important; }
            .col-subject { width: 20% !important; }
            .col-dest { width: 25% !important; }
            .col-note { width: 25% !important; }
            .col-value { width: 30% !important; }
        }
        
        body {
            font-family: 'MS Gothic', monospace, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        
        .app-container {
            font-family: 'MS Gothic', monospace, sans-serif;
            font-size: 12px;
            background-color: white;
            border: 2px solid black;
            max-width: 1200px;
            margin: 10px auto;
            padding: 0 8px;
        }
        
        .header {
            background-color: #e0e0e0;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid black;
            font-size: 16px;
        }
        
        .print-date-section {
            display: none;
            text-align: center;
            padding: 4px;
            font-size: 12px;
            font-weight: bold;
            border-bottom: 1px solid black;
        }
        
        .date-input-section {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
            padding: 0 8px;
        }
        
        .date-input {
            font-size: 14px;
            padding: 5px;
            border: 1px solid black;
            font-family: monospace;
        }
        
        .today-btn {
            margin-left: 10px;
            padding: 3px 8px;
            font-size: 12px;
            border: 1px solid black;
            background-color: #f0f0f0;
            cursor: pointer;
        }
        
        .today-btn:hover {
            background-color: #d0d0d0;
        }
        
        .date-display {
            margin-left: 10px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }
        
        .left-section {
            border-right: 2px solid black;
            padding-right: 8px;
        }
        
        .right-section {
            padding-left: 8px;
        }
        
        .spacer {
            height: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            table-layout: fixed;
            margin-bottom: 15px;
        }
        
        th, td {
            border: 1px solid black;
            padding: 4px;
            text-align: center;
        }
        
        th {
            background-color: #c0c0c0;
            font-weight: bold;
        }
        
        .data-row {
            background-color: #f8f8f8;
        }
        
        .total-row {
            background-color: #e0e0e0;
            font-weight: bold;
        }
        
        .input-field {
            border: none;
            background: transparent;
            font-family: 'MS Gothic', monospace, sans-serif;
            font-size: 11px;
            text-align: right;
            width: 100%;
        }
        
        .input-field-center {
            text-align: center;
        }
        
        .overflow-hidden {
            overflow: hidden;
        }
        
        .truncate {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .buttons-section {
            text-align: center;
            margin: 15px;
            padding: 15px;
            border-top: 2px solid black;
        }
        
        .btn {
            padding: 10px 20px;
            margin: 5px;
            font-size: 14px;
            border: 2px solid black;
            cursor: pointer;
            font-family: monospace;
        }
        
        .btn-clear {
            background-color: #ffcccc;
        }
        
        .btn-clear:hover {
            background-color: #ffaaaa;
        }
        
        .btn-print {
            background-color: #ccccff;
        }
        
        .btn-print:hover {
            background-color: #aaaaff;
        }
        
        .btn-export {
            background-color: #cccccc;
        }
        
        .btn-export:hover {
            background-color: #aaaaaa;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            border: 2px solid black;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .btn-yes {
            padding: 8px 16px;
            background-color: #ff5555;
            color: white;
            border: 1px solid black;
            cursor: pointer;
        }
        
        .btn-yes:hover {
            background-color: #ff3333;
        }
        
        .btn-no {
            padding: 8px 16px;
            background-color: #d0d0d0;
            border: 1px solid black;
            cursor: pointer;
        }
        
        .btn-no:hover {
            background-color: #b0b0b0;
        }
        
        .message {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 1001;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .left-section {
                border-right: none;
                border-bottom: 2px solid black;
                margin-bottom: 20px;
                padding-right: 0;
            }
            
            .right-section {
                padding-left: 0;
            }
            
            .spacer {
                display: none;
            }
            
            .app-container {
                margin: 5px;
                padding: 0 4px;
            }
            
            table {
                font-size: 10px;
            }
            
            .input-field {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container print-container">
        <!-- ヘッダー -->
        <div class="header print-header">
            歯科医院 日計表入力
        </div>

        <!-- 印刷用日付表示 -->
        <div class="print-date-section print-block print-date" id="printDate">
            日付: <span id="printDateValue"></span> <span id="printDateDisplay"></span>
        </div>

        <!-- 日付入力 -->
        <div class="date-input-section no-print">
            <label>日付: </label>
            <input type="date" id="reportDate" class="date-input">
            <button class="today-btn" onclick="setToday()">今日</button>
            <span class="date-display" id="dateDisplay"></span>
        </div>

        <!-- 確認ダイアログ -->
        <div class="modal hidden no-print" id="confirmModal">
            <div class="modal-content">
                <p style="text-align: center; margin-bottom: 15px; font-family: monospace;">全てのデータをクリアしますか？</p>
                <div class="modal-buttons">
                    <button class="btn-yes" onclick="confirmClear()">はい</button>
                    <button class="btn-no" onclick="cancelClear()">いいえ</button>
                </div>
            </div>
        </div>

        <!-- メッセージ表示 -->
        <div class="message hidden no-print" id="messageBox"></div>

        <!-- メインレイアウト -->
        <div class="grid">
            <!-- 左側：ストックと金種 -->
            <div class="left-section">
                <div class="spacer"></div>

                <!-- ストック -->
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th colspan="3">ストック</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="data-row">
                            <td class="col-item">5百円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="stock500" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="stock500Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">100円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="stock100" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="stock100Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">50円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="stock50" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="stock50Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">10円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="stock10" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="stock10Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">5円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="stock5" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="stock5Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">1円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="stock1" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="stock1Total">0</span></td>
                        </tr>
                        <tr class="total-row">
                            <td class="col-item">ストック</td>
                            <td class="col-count"></td>
                            <td class="col-amount"><span id="stockGrandTotal">0</span></td>
                        </tr>
                    </tbody>
                </table>

                <!-- 本日の残高金種 -->
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th colspan="3">本日の残高金種</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="data-row">
                            <td class="col-item">1万円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="bill10000" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="bill10000Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">5千円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="bill5000" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="bill5000Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">2千円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="bill2000" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="bill2000Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">千円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="bill1000" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="bill1000Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">5百円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="coin500" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="coin500Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">100円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="coin100" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="coin100Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">50円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="coin50" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="coin50Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">10円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="coin10" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="coin10Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">5円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="coin5" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="coin5Total">0</span></td>
                        </tr>
                        <tr class="data-row">
                            <td class="col-item">1円</td>
                            <td class="col-count"><input type="number" class="input-field print-input-s" id="coin1" oninput="updateCalculations()">枚</td>
                            <td class="col-amount"><span id="coin1Total">0</span></td>
                        </tr>
                        <tr class="total-row">
                            <td class="col-item">ストック</td>
                            <td class="col-count"></td>
                            <td class="col-amount"><span id="stockTotal2">0</span></td>
                        </tr>
                        <tr class="total-row">
                            <td class="col-item">本日の残高</td>
                            <td class="col-count"></td>
                            <td class="col-amount"><span id="currencyTotal">0</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 右側：窓口現金入出金 -->
            <div class="right-section">
                <!-- 窓口現金入金の記録 -->
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th colspan="4">窓口現金入金の記録</th>
                        </tr>
                        <tr>
                            <th class="col-subject">科目</th>
                            <th class="col-dest">入金先</th>
                            <th class="col-note">摘要</th>
                            <th class="col-value">入金額</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>社保</td>
                            <td>窓口収入合計</td>
                            <td><input type="number" class="input-field print-input-s" id="shahoCount" oninput="updateCalculations()">名</td>
                            <td><input type="number" class="input-field print-input-m" id="shahoIncome" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td>国保</td>
                            <td>窓口収入合計</td>
                            <td><input type="number" class="input-field print-input-s" id="kokuhoCount" oninput="updateCalculations()">名</td>
                            <td><input type="number" class="input-field print-input-m" id="kokuhoIncome" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td>後期高齢者</td>
                            <td>窓口収入合計</td>
                            <td><input type="number" class="input-field print-input-s" id="koukiCount" oninput="updateCalculations()">名</td>
                            <td><input type="number" class="input-field print-input-m" id="koukiIncome" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td>自費</td>
                            <td>窓口収入合計</td>
                            <td><input type="number" class="input-field print-input-s" id="jihiCount" oninput="updateCalculations()">名</td>
                            <td><input type="number" class="input-field print-input-m" id="jihiIncome" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td>物販収入</td>
                            <td>窓口収入合計</td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="bushanNote"></td>
                            <td><input type="number" class="input-field print-input-m" id="bushanIncome" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="extraIncome1Subject"></td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="extraIncome1Destination"></td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="extraIncome1Note"></td>
                            <td><input type="number" class="input-field print-input-m" id="extraIncome1Amount" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="extraIncome2Subject"></td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="extraIncome2Destination"></td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="extraIncome2Note"></td>
                            <td><input type="number" class="input-field print-input-m" id="extraIncome2Amount" oninput="updateCalculations()"></td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="3">合計</td>
                            <td><span id="incomeTotal">0</span></td>
                        </tr>
                    </tbody>
                </table>

                <!-- 窓口現金出金の記録 -->
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th colspan="4">窓口現金出金の記録</th>
                        </tr>
                        <tr>
                            <th class="col-subject">科目</th>
                            <th class="col-dest">出金先</th>
                            <th class="col-note">摘要</th>
                            <th class="col-value">出金額</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>前回差額</td>
                            <td>返金</td>
                            <td></td>
                            <td><input type="number" class="input-field print-input-m" id="refund" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="expense2Subject"></td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="expense2Destination"></td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="expense2Note"></td>
                            <td><input type="number" class="input-field print-input-m" id="expense2" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="expense3Subject"></td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="expense3Destination"></td>
                            <td><input type="text" class="input-field input-field-center print-input-center" id="expense3Note"></td>
                            <td><input type="number" class="input-field print-input-m" id="expense3" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td>院長へ</td>
                            <td><input type="number" class="input-field print-input-m" id="expenseDirector" oninput="updateCalculations()"></td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="3">合計</td>
                            <td><span id="expenseTotal">0</span></td>
                        </tr>
                    </tbody>
                </table>

                <!-- 窓口現金出納 -->
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th colspan="2">窓口現金出納</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>前日の繰越</td>
                            <td><input type="number" class="input-field print-input-l" id="previousBalance" oninput="updateCalculations()"></td>
                        </tr>
                        <tr>
                            <td>本日の現金入金</td>
                            <td><span id="todayIncome">0</span></td>
                        </tr>
                        <tr>
                            <td>本日の現金出金</td>
                            <td><span id="todayExpense">0</span></td>
                        </tr>
                        <tr class="total-row">
                            <td>本日の残高</td>
                            <td><span id="finalBalance">0</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ボタンセクション -->
        <div class="buttons-section no-print">
            <button class="btn btn-clear" onclick="clearAll()">全クリア</button>
            <button class="btn btn-print" onclick="printReport()">印刷
